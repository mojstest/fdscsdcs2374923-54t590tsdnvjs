<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================================
       META / HEAD
       ========================================================= -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>üéÇ Happy Birthday My love!‚ô•Ô∏è</title>

  <!-- Performance -->
  <link rel="preload" as="audio" href="assets/music.mp3" />
  <link rel="preload" as="image" href="assets/photo7.jpg" />

  <style>
    /* =========================================================
       THEME TOKENS
       ========================================================= */
    :root{
      --accent: #ff4fa3;
      --accent-2: #b784ff;

      --bg-1: #120616;
      --bg-2: #1b0c24;

      --card: color-mix(in oklab, #000 70%, #fff 0%);
      --text: #f9eefd;
      --muted: #dcc6e6;

      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-1: 0 10px 30px rgba(0,0,0,.45);
      --shadow-2: 0 6px 18px rgba(0,0,0,.32);

      --gap: clamp(12px, 2.8vw, 24px);
      --pad: clamp(12px, 2.5vw, 20px);
    }

    /* =========================================================
       BASE / RESET
       ========================================================= */
    *,*::before,*::after{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(40% 60% at 50% 110%, #0c0410 0%, transparent 70%),
        linear-gradient(180deg, var(--bg-2), var(--bg-1));
      overflow-x:hidden;
      line-height:1.45;
    }
    :focus-visible{ outline: 2px dashed var(--accent); outline-offset: 3px }
    a,button,input,select,textarea{ font:inherit }
    button{ cursor:pointer }
    /* üîß IMPORTANT: UA stylesheet gives figure {margin: 1em 40px}. Kill it. */
    figure{ margin:0 }
    img{ display:block }

    /* =========================================================
       BACKGROUND FX (bokeh) + WALLPAPER
       ========================================================= */
    body::before{
      content:"";
      position:fixed; inset:-10vmax;
      z-index:-1;
      background:
        radial-gradient(120px 120px at 20% 30%, color-mix(in oklab, var(--accent) 26%, transparent) 0 60%, transparent 61%) ,
        radial-gradient(160px 160px at 80% 70%, color-mix(in oklab, var(--accent-2) 26%, transparent) 0 60%, transparent 61%),
        radial-gradient(90px 90px at 60% 20%, color-mix(in oklab, #ff8bd2 32%, transparent) 0 60%, transparent 61%);
      filter: blur(12px);
      opacity:.28;
      animation: drift 26s linear infinite;
      pointer-events:none;
    }
    @keyframes drift{
      from{ transform: translate3d(-2%, -1%, 0) rotate(0deg) }
      to  { transform: translate3d(2%, 1%, 0) rotate(1turn) }
    }
    @media (prefers-reduced-motion: reduce){ body::before{ animation: none; opacity:.18 } }

    /* Wallpaper */
    #wallpaper{
      position: fixed;
      inset: clamp(16px, 6vmin, 64px);
      z-index: -2;
      background-image: url("assets/wallpaper.jpg");
      background-size: cover;
      background-position: center;
      border-radius: clamp(12px, 3.2vw, 22px);
      box-shadow: 0 40px 120px rgba(0,0,0,.55), inset 0 0 0 1px rgba(255,255,255,.06);
      filter: saturate(1.05) contrast(1.06) brightness(.72);
      opacity: .35;
      pointer-events: none;
    }

    /* =========================================================
       HEADER / HERO
       ========================================================= */
    header{
      text-align:center;
      padding: clamp(16px, 4vw, 40px) var(--pad) 10px;
    }
    .hero-badge{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background-image: linear-gradient(180deg, #ffd7ef, #e7d8ff);
      color:#2a1730;
      font-weight:600;
      box-shadow: var(--shadow-2);
      letter-spacing:.2px;
    }
    h1{
      margin: .5rem 0 0;
      font-size: clamp(2rem, 6.5vw, 4rem);
      line-height:1.05;
      letter-spacing:.5px;
      text-shadow: 0 2px 0 rgba(0,0,0,.3);
    }
    .hero-sub{
      margin-top:.35rem;
      font-size: clamp(1rem, 3.4vw, 1.3rem);
      color:var(--muted);
    }

    /* =========================================================
       LAYOUT
       ========================================================= */
    main{
      display:grid;
      gap: var(--gap);
      padding: 0 var(--pad) var(--pad);
      grid-template-columns: 1fr;
      max-width: 1160px;
      margin: 0 auto;
      position: relative;
      z-index: 0;
    }
    @media (min-width: 860px){
      main{ grid-template-columns: 1fr 1fr; align-items: start; }
    }

    .card{
      background: color-mix(in oklab, var(--card), transparent 0%);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-1);
      overflow: clip;
      border: 1px solid color-mix(in oklab, #fff 8%, #000 92%);
    }

    /* =========================================================
       SLIDESHOW / CAROUSEL
       ========================================================= */
    .slideshow{ display:grid; grid-template-rows: auto auto; gap: 8px; padding: 8px; /* set --ratio here if you want */ }
    .viewport{
      position:relative;
      border-radius: clamp(10px, 2vw, 14px);
      overflow:hidden;
      aspect-ratio: var(--ratio, 4/3); /* change to 16/9 etc. */
      background: #160a22;
      outline: 1px solid rgba(255,255,255,.08);
      contain: layout paint; /* smoother */
    }

    /* important: no spacing between items */
    .slideshow .track{ gap:0 }
    .slideshow .slide{ margin:0 }

    /* exact movement math via CSS vars */
    .track{
      display:flex; height:100%;
      width: calc(100% * var(--n, 1));
      will-change: transform;
      transition: transform .7s cubic-bezier(.22,.61,.36,1);
      transform: translate3d(calc(-1 * var(--i, 0) * (100% / var(--n, 1))), 0, 0);
    }
    .slide{
      flex: 0 0 calc(100% / var(--n, 1));
      min-width: calc(100% / var(--n, 1));
      height:100%;
      position: relative;
    }
    .slide > img{
      width:100%; height:100%;
      object-fit:cover; object-position:center; display:block;
      background:#0d0615;
    }
    .slide > img.contain{
      object-fit: contain;
      background:
        radial-gradient(100% 100% at 50% 50%, rgba(255,255,255,.06), transparent 60%),
        #0d0615;
    }
    .slide-caption{
      position:absolute; left:10px; bottom:10px;
      background: color-mix(in oklab, #000 42%, var(--accent) 12%);
      color:#fff; padding: 6px 10px; border-radius: 999px;
      font-size: clamp(.75rem, 2.4vw, .9rem);
      backdrop-filter: blur(6px);
    }
    .controls{ display:flex; align-items:center; gap:8px; justify-content: space-between; padding: 6px; }
    .btn{
      appearance:none; border: 0; padding: .6rem .9rem; border-radius: 12px;
      background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 86%, #fff 0%), color-mix(in oklab, var(--accent) 64%, #000 10%));
      color:#2a0f22; font-weight: 700; letter-spacing:.2px;
      box-shadow: 0 4px 14px rgba(255, 79, 163, .3);
    }
    .btn.secondary{ background: linear-gradient(180deg, #3a1b5a, #281342); color:#f0e7ff; box-shadow: 0 4px 14px rgba(0,0,0,.35); }
    .dots{ display:flex; gap:6px; align-items:center; margin-inline: auto; }
    .dot{
      width:8px; height:8px; border-radius:999px; background:#644b86; opacity:.9; transition: transform .2s ease, background .2s;
    }
    .dot[aria-current="true"]{ background: var(--accent-2); box-shadow: 0 0 0 3px rgba(183,132,255,.22); transform: scale(1.15); }

    /* =========================================================
       UTILITY ROW
       ========================================================= */
    .utility{ display:flex; flex-wrap:wrap; gap:8px; padding: var(--pad); justify-content:center; }
    .pill{
      background: linear-gradient(180deg, #2d1743, #1d0f2e);
      border:1px solid rgba(255,255,255,.14);
      color:#f4eaff; border-radius: 999px; padding: .55rem .9rem;
      display:inline-flex; align-items:center; gap:.5rem; box-shadow: var(--shadow-2);
    }
    .pill .mini{ font-size: .95rem }
    .pill .icon{ filter: drop-shadow(0 1px 0 rgba(0,0,0,.25)) }
    #musicToggle[hidden]{ display:none !important; }

    /* =========================================================
       VIDEO CARD
       ========================================================= */
    .video-card{ padding: var(--pad); display:grid; gap:10px; }
    video{
      width:100%; height:auto; border-radius: var(--radius-md); display:block;
      box-shadow: var(--shadow-1); background:#10061a; outline: 1px solid rgba(255,255,255,.08);
    }
    .video-note{ color:var(--muted); font-size: .95rem }

    /* =========================================================
       FOOTER
       ========================================================= */
    footer{
      text-align:center; color: var(--muted);
      padding: 20px var(--pad) 36px; font-size: clamp(.9rem, 2.3vw, 1rem);
    }

    /* =========================================================
       START OVERLAY
       ========================================================= */
    .overlay{
      position:fixed; inset:0; z-index: 9999; display:grid; place-items:center;
      background:
        radial-gradient(60vmax 40vmax at 50% 30%, color-mix(in oklab, var(--accent) 7%, transparent) 0 70%, transparent),
        linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.72));
      backdrop-filter: blur(2px);
    }
    .overlay-inner{ text-align:center; display:grid; gap: 12px; }
    .party-btn{
      font-size: clamp(1.05rem, 4.6vw, 1.35rem); padding: .9rem 1.3rem; border-radius: 14px; border:0;
      color:#2a0f22; font-weight:800; letter-spacing:.3px;
      background: conic-gradient(from 0deg, #ffd7ef, #e9d6ff, #ffd7ef);
      box-shadow: 0 10px 28px rgba(255, 79, 163, .38);
    }
    .overlay-hint{ color:#f2dbff; font-size:.95rem }

    /* =========================================================
       EFFECTS LAYERS
       ========================================================= */
    #confetti{ position: fixed; inset:0; pointer-events:none; z-index: 9990 }
    #balloons{ position: fixed; inset:0; pointer-events:none; z-index: 9980; overflow:hidden }
    #stickers{ position: fixed; inset:0; pointer-events:none; z-index: 9970; overflow:hidden }

    .balloon{
      position:absolute;
      width: clamp(20px, 4.6vw, 36px);
      height: clamp(28px, 7vw, 52px);
      border-radius: 50% 50% 45% 45% / 55% 55% 45% 45%;
      opacity:.9;
      transform: translateY(100vh);
      box-shadow: inset 0 -8px 18px rgba(0,0,0,.18);
      animation: rise linear both;
    }
    .balloon::after{
      content:"";
      position:absolute; left:50%; bottom:-40%;
      width:2px; height: 40%;
      background: linear-gradient(180deg, #f0d9ff, #b784ff);
      transform: translateX(-50%);
      opacity:.7;
    }
    @keyframes rise{
      from{ transform: translateY(105vh) translateX(var(--x, 0)) rotate(-2deg) }
      to  { transform: translateY(-110px) translateX(calc(var(--x, 0) + 10px)) rotate(6deg) }
    }

    .sticker{
      position:absolute;
      width: calc(var(--sz,1) * clamp(22px, 4.2vw, 48px));
      height: calc(var(--sz,1) * clamp(22px, 4.2vw, 48px));
      opacity: var(--alpha, .38);
      transform: translate3d(0,0,0) scale(1);
      animation: bob var(--dur, 10s) ease-in-out infinite alternate;
      filter: saturate(.9) brightness(.9) drop-shadow(0 2px 4px rgba(0,0,0,.35));
      mix-blend-mode: normal;
    }
    .sticker svg{ width:100%; height:100%; display:block }
    @keyframes bob{
      from{ transform: translate3d(0,0,0) rotate(-6deg) }
      to  { transform: translate3d(var(--dx, 14px), var(--dy, -20px), 0) rotate(6deg) }
    }

    @media (prefers-reduced-motion: reduce){
      .balloon{ animation-duration: .001s }
      .sticker{ animation: none }
    }

    /* =========================================================
       TOAST
       ========================================================= */
    .toast{
      position: fixed; left:50%; bottom: 18px; transform: translateX(-50%);
      background: #1e0f2b; color:#f6e9ff; padding: .6rem .9rem; border-radius: 999px;
      border:1px solid rgba(255,255,255,.14); box-shadow: var(--shadow-2);
      opacity:0; translate: 0 6px; transition: opacity .25s, translate .25s; z-index: 99999;
    }
    .toast.show{ opacity:1; translate: 0 0 }

    @media (prefers-reduced-data: reduce){ body::before{ opacity:.12 } }
  </style>
</head>
<body>
  <!-- =========================================================
       BACKGROUND WALLPAPER LAYER
       ========================================================= -->
  <div id="wallpaper" aria-hidden="true"></div>

  <!-- =========================================================
       HEADER / HERO
       ========================================================= -->
  <header aria-labelledby="title">
    <span class="hero-badge" aria-hidden="true">üéâ It‚Äôs Party Time</span>
    <h1 id="title">Happy 21st Birthday <span id="friendName">Fatemeh</span>! ü•≥‚ô•Ô∏èü¶Ä</h1>
    <p class="hero-sub">Wish you a happiness, success, peace and more and more cuteness everydayüêà!</p>
  </header>

  <!-- =========================================================
       MAIN CONTENT
       ========================================================= -->
  <main>
    <!-- ===================== SLIDESHOW ===================== -->
    <section class="card slideshow" aria-label="Photo slideshow">
      <div class="viewport" aria-live="polite">
        <!-- Slides are injected by JS -->
        <div class="track" id="track" style="--n:1; --i:0"></div>
      </div>

      <div class="controls">
        <button class="btn secondary" id="prev" aria-label="Previous photo">‚üµ Prev</button>
        <div class="dots" id="dots" role="tablist" aria-label="Slide indicators"></div>
        <button class="btn secondary" id="next" aria-label="Next photo">Next ‚ü∂</button>
      </div>

      <div class="utility" role="group" aria-label="Utilities">
        <button class="pill" id="musicToggle" hidden aria-pressed="false" aria-label="Play or pause the birthday music">
          <span class="icon" aria-hidden="true">üéµ</span><span class="mini" id="musicLabel">Play music</span>
        </button>

        <button class="pill" id="slideAutoToggle" aria-pressed="true" aria-label="Pause or play slideshow autoplay">
          <span class="icon" aria-hidden="true">üñºÔ∏è</span><span class="mini" id="slideAutoLabel">Slideshow: Pause</span>
        </button>

        <button class="pill" id="shareBtn" aria-label="Share or copy link">
          <span class="icon" aria-hidden="true">üîó</span><span class="mini">Share / Copy link</span>
        </button>
      </div>
    </section>

    <!-- ===================== VIDEO ===================== -->
    <section class="card video-card" aria-labelledby="vidTitle">
      <h2 id="vidTitle" style="margin:0; font-size: clamp(1.2rem, 4.2vw, 1.6rem)">A little birthday clip üé¨üé∏</h2>
      <video
        id="video"
        src="assets/video.mp4"
        preload="metadata"
        playsinline
        controls
        width="1280"
        height="720"
      >
        Sorry, your browser can‚Äôt play the embedded video.
      </video>
      <p class="video-note">I wanted to play a better new version but my guitar was broken, so hope u still enjoy it on this very special day!‚ô•Ô∏èüé∏üë®‚ÄçüöÄ</p>
    </section>
  </main>

  <!-- =========================================================
       FOOTER
       ========================================================= -->
  <footer>
    ¬© <span id="year"></span> With a love extended to Adromeda, beyond and back ‚Ä¢ Made By Moji‚ô•Ô∏èüë®‚ÄçüöÄ.
  </footer>

  <!-- =========================================================
       START OVERLAY
       ========================================================= -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Start birthday celebration">
    <div class="overlay-inner">
      <button id="start" class="party-btn">üí•Tap to start the party!‚ô•Ô∏èüêàü¶Ä</button>
      <div class="overlay-hint">Start to get your suprise made by your biggest friend and supporter, Moji!</div>
    </div>
  </div>

  <!-- =========================================================
       EFFECTS LAYERS
       ========================================================= -->
  <canvas id="confetti" aria-hidden="true"></canvas>
  <div id="balloons" aria-hidden="true"></div>
  <div id="stickers" aria-hidden="true"></div>

  <!-- =========================================================
       MEDIA
       ========================================================= -->
  <audio id="music" src="assets/music.mp3" preload="none"></audio>

  <!-- =========================================================
       LIVE REGIONS / TOAST
       ========================================================= -->
  <div id="sr" class="sr-only" aria-live="polite" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;">Ready</div>
  <div id="toast" class="toast" role="status" aria-live="polite">Copied!</div>

  <script>
  /* ============================================================
     SLIDESHOW HOW-TO (edit these without touching HTML)
     ------------------------------------------------------------
     - Add photos: update SLIDES (files under ASSETS_DIR)
     - Aspect ratio box: set CSS var --ratio on .slideshow (e.g., 16/9)
     - Autoplay: AUTOPLAY = true|false; INTERVAL_MS = 3800
     - Contain/Cover thresholds: RATIO_CONTAIN_MIN / RATIO_CONTAIN_MAX
     - Format fallbacks on 404: FALLBACK_EXTS order
     ============================================================ */

  (function(){
    const $  = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    /* ---------- Config (edit) ---------- */
    const ASSETS_DIR = "assets/";
    const SLIDES = [
      "photo1.jpg",
      "photo2.jpg",
      "photo3.jpg",
      "photo4.jpg",
      "photo5.jpg",
      "photo6.jpg",
      "photo7.jpg"
      // add more‚Ä¶
    ];

    let AUTOPLAY    = true;     // will auto-disable if prefers-reduced-motion
    let INTERVAL_MS = 3800;

    const RATIO_CONTAIN_MIN = 0.90;
    const RATIO_CONTAIN_MAX = 1.60;

    const FALLBACK_EXTS = ['jpg','jpeg','png','webp','avif'];

    /* ---------- Elements ---------- */
    const overlay       = $('#overlay');
    const startBtn      = $('#start');
    const music         = $('#music');
    const musicToggle   = $('#musicToggle');
    const musicLabel    = $('#musicLabel');
    const slideAutoBtn  = $('#slideAutoToggle');
    const slideAutoLabel= $('#slideAutoLabel');
    const shareBtn      = $('#shareBtn');
    const toast         = $('#toast');
    const confettiCanvas= $('#confetti');
    const balloonsLayer = $('#balloons');
    const stickersLayer = $('#stickers');
    const sr            = $('#sr');
    const nameEl        = $('#friendName');
    const yearEl        = $('#year');
    const videoEl       = $('#video');

    const viewport = $('.viewport');
    const track    = $('#track');
    const dotsWrap = $('#dots');
    const prevBtn  = $('#prev');
    const nextBtn  = $('#next');

    /* ---------- State ---------- */
    let index = 0;
    let timer = null;
    let hasCelebrated = false;
    let musicWasPlayingBeforeVideo = false;

    const prefersReducedMotion = () => matchMedia('(prefers-reduced-motion: reduce)').matches;
    const prefersReducedData   = () => (navigator.connection?.saveData) || matchMedia('(prefers-reduced-data: reduce)').matches;

    yearEl.textContent = new Date().getFullYear();
    if(!nameEl.textContent.trim()){ nameEl.textContent = 'Friend'; }

    if (prefersReducedMotion()) AUTOPLAY = false;

    /* ============================================================
       Build Slides from SLIDES[]
       ============================================================ */
    function resolveSrc(name){
      if (/^https?:\/\//i.test(name) || name.startsWith('/') || name.includes('/')) return name;
      return ASSETS_DIR + name;
    }
    const baseWithoutExt = (url)=> url.replace(/\.\w+(?=$|[#?])/,'');
    const extFromUrl     = (url)=> (url.match(/\.([a-z0-9]+)(?=$|[#?])/i)||[])[1]?.toLowerCase() || '';

    function setupImgFallback(img){
      const tried = new Set();
      const base = img.getAttribute('data-base') || baseWithoutExt(img.src);
      const startExt = img.getAttribute('data-ext') || extFromUrl(img.src);
      if (startExt) tried.add(startExt);
      img.addEventListener('error', function onErr(){
        const nextExt = FALLBACK_EXTS.find(ext => !tried.has(ext));
        if (!nextExt){ img.removeEventListener('error', onErr); return; }
        tried.add(nextExt);
        img.src = `${base}.${nextExt}`;
      });
    }

    function createSlide(i, src){
      const fig = document.createElement('figure');
      fig.className = 'slide';

      const img = document.createElement('img');
      img.loading = 'lazy';
      img.decoding = 'async';
      img.width = 1600; img.height = 1200;

      const fullSrc = resolveSrc(src);
      img.src = fullSrc;
      img.alt = `Photo ${i+1}`;
      img.setAttribute('data-base', baseWithoutExt(fullSrc));
      img.setAttribute('data-ext', extFromUrl(fullSrc));
      setupImgFallback(img);

      img.addEventListener('load', ()=>{
        const r = (img.naturalWidth || 1) / (img.naturalHeight || 1);
        if (r < RATIO_CONTAIN_MIN || r > RATIO_CONTAIN_MAX){
          img.classList.add('contain');
        }
      });

      const cap = document.createElement('figcaption');
      cap.className = 'slide-caption';
      cap.textContent = `#${i+1}`;

      fig.appendChild(img);
      fig.appendChild(cap);
      return fig;
    }

    function renderSlides(){
      track.innerHTML = '';
      const n = Math.max(1, SLIDES.length);
      track.style.setProperty('--n', n);
      SLIDES.forEach((s, i)=> track.appendChild(createSlide(i, s)));
      buildDots(n);
      setIndex(0, false);
    }

    /* ============================================================
       Dots / Nav
       ============================================================ */
    let dots = [];
    function buildDots(n){
      dotsWrap.innerHTML = '';
      dots = [];
      for(let i=0;i<n;i++){
        const d = document.createElement('span');
        d.className = 'dot';
        d.setAttribute('role', 'tab');
        d.setAttribute('aria-label', `Photo ${i+1}`);
        d.addEventListener('click', ()=>{ setIndex(i); kickAutoplay(); });
        dotsWrap.appendChild(d);
        dots.push(d);
      }
      updateDots();
    }
    function updateDots(){
      dots.forEach((d, i)=> d.setAttribute('aria-current', i===index ? 'true' : 'false'));
    }

    /* ============================================================
       Movement (via CSS vars --i and --n)
       ============================================================ */
    function setIndex(i, announce = true){
      const n = Math.max(1, SLIDES.length);
      index = (i + n) % n;
      track.style.setProperty('--i', index);
      updateDots();
      if(announce){ sr.textContent = `Photo ${index+1} of ${n}`; }
    }
    const next = ()=> setIndex(index+1);
    const prev = ()=> setIndex(index-1);

    /* Keep transform stable on resize */
    if('ResizeObserver' in window){
      new ResizeObserver(()=> track.style.setProperty('--i', index)).observe(viewport);
    }else{
      addEventListener('resize', ()=> track.style.setProperty('--i', index));
    }

    /* Pointer/touch swipe */
    (function(){
      let x0=null, t0=0, dragging=false;
      const onStart = (e)=>{
        dragging=true;
        x0 = (e.touches?e.touches[0].clientX:e.clientX);
        t0 = performance.now();
      };
      const onEnd = (e)=>{
        if(!dragging) return;
        dragging=false;
        const x1 = (e.changedTouches?e.changedTouches[0].clientX:e.clientX);
        const dx = x1 - x0;
        const dt = performance.now() - t0;
        if(Math.abs(dx) > 40 && dt < 600){ dx<0 ? next() : prev(); kickAutoplay(); }
        x0=null;
      };
      viewport.addEventListener('pointerdown', onStart);
      viewport.addEventListener('pointerup', onEnd);
      viewport.addEventListener('touchstart', onStart, {passive:true});
      viewport.addEventListener('touchend', onEnd);
    })();

    /* Controls */
    nextBtn.addEventListener('click', ()=>{ next(); kickAutoplay(); });
    prevBtn.addEventListener('click', ()=>{ prev(); kickAutoplay(); });

    /* ============================================================
       Autoplay
       ============================================================ */
    function startAuto(){
      if(timer) return;
      slideAutoBtn.setAttribute('aria-pressed','true');
      slideAutoLabel.textContent = 'Slideshow: Pause';
      timer = setInterval(()=> next(), INTERVAL_MS);
    }
    function stopAuto(){
      slideAutoBtn.setAttribute('aria-pressed','false');
      slideAutoLabel.textContent = 'Slideshow: Play';
      clearInterval(timer); timer = null;
    }
    function toggleAuto(){ timer ? stopAuto() : startAuto(); }
    function kickAutoplay(){
      if(!timer) return;
      clearInterval(timer);
      timer = setInterval(()=> next(), INTERVAL_MS);
    }
    slideAutoBtn.addEventListener('click', toggleAuto);
    if(AUTOPLAY){ startAuto(); } else { stopAuto(); }

    /* ============================================================
       MUSIC CONTROLS
       ============================================================ */
    function updateMusicUI(){
      const playing = !music.paused;
      musicToggle.setAttribute('aria-pressed', String(playing));
      musicLabel.textContent = playing ? 'Pause music' : 'Play music';
    }
    musicToggle.addEventListener('click', async ()=>{
      if(!videoEl.paused){
        showToast('Music stays paused while video plays üìπ');
        if(!music.paused){ music.pause(); }
        updateMusicUI();
        return;
      }
      try{
        if(music.paused){ await music.play(); }
        else { music.pause(); }
      }catch{
        showToast('Unable to play audio. Check device volume.');
      }finally{ updateMusicUI(); }
    });
    music.addEventListener('play', updateMusicUI);
    music.addEventListener('pause', updateMusicUI);

    /* Video pauses/resumes music */
    videoEl.addEventListener('play', ()=>{
      musicWasPlayingBeforeVideo = !music.paused;
      if(musicWasPlayingBeforeVideo){ music.pause(); }
      updateMusicUI();
    });
    function resumeMusicIfNeeded(){
      if(hasCelebrated && musicWasPlayingBeforeVideo){
        music.play().catch(()=>{});
        updateMusicUI();
      }
    }
    videoEl.addEventListener('pause', resumeMusicIfNeeded);
    videoEl.addEventListener('ended', resumeMusicIfNeeded);

    /* ============================================================
       SHARE / COPY LINK
       ============================================================ */
    shareBtn.addEventListener('click', async ()=>{
      const shareData = { title: document.title, text: 'üéÇ Join the birthday page!', url: location.href };
      try{
        if(navigator.share){
          await navigator.share(shareData);
        }else{
          await navigator.clipboard.writeText(location.href);
          showToast('Link copied to clipboard ‚úîÔ∏è');
        }
      }catch(e){
        try{
          await navigator.clipboard.writeText(location.href);
          showToast('Link copied to clipboard ‚úîÔ∏è');
        }catch{
          showToast('Copy failed. Long-press the address bar to share.');
        }
      }
    });

    /* ============================================================
       TOAST
       ============================================================ */
    let toastTimer = null;
    function showToast(msg='Done'){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.classList.remove('show'), 1800);
    }

    /* ============================================================
       START OVERLAY ‚Üí PARTY!
       ============================================================ */
    startBtn.addEventListener('click', async ()=>{
      if(hasCelebrated) return;
      try{ await music.play(); }catch{}
      musicToggle.removeAttribute('hidden');
      updateMusicUI();
      setTimeout(()=> musicToggle.focus(), 60);
      celebrate();
      overlay.remove();
    });

    overlay.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault(); startBtn.click();
      }
    });

    function celebrate(){
      if(hasCelebrated) return;
      hasCelebrated = true;
      confettiBurst();
      const disableStickerAnim = prefersReducedData();
      spawnStickers(disableStickerAnim ? 16 : 28, disableStickerAnim);
      if(!prefersReducedData()){
        spawnBalloons(26);
      } else {
        showToast('Effects reduced to save data.');
      }
    }

    /* ============================================================
       CONFETTI
       ============================================================ */
    function confettiBurst(){
      const ctx = confettiCanvas.getContext('2d');
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const {innerWidth: W, innerHeight: H} = window;
      confettiCanvas.width = Math.floor(W * dpr);
      confettiCanvas.height = Math.floor(H * dpr);
      confettiCanvas.style.width = W + 'px';
      confettiCanvas.style.height = H + 'px';
      ctx.scale(dpr, dpr);

      const n = 150;
      const colors = ['#ffd7ef','#b784ff','#ff8bd2','#ffb3e1','#e1c6ff','#ffcadf','#dcb2ff'];
      const parts = Array.from({length:n}, ()=>({
        x: W/2, y: H*0.35,
        vx: (Math.random()*2-1)*7,
        vy: (Math.random()*-1-0.8)*10,
        w: Math.random()*8+5,
        h: Math.random()*3+2,
        rot: Math.random()*Math.PI,
        vr: (Math.random()*2-1)*0.2,
        col: colors[(Math.random()*colors.length)|0]
      }));
      const start = performance.now();
      const grav = 0.25, air = 0.996;

      function frame(t){
        const elapsed = t - start;
        ctx.clearRect(0,0,W,H);
        for(const p of parts){
          p.vy += grav;
          p.vx *= air; p.vy *= air;
          p.x += p.vx; p.y += p.vy;
          p.rot += p.vr;
          ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rot);
          ctx.fillStyle = p.col; ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
          ctx.restore();
        }
        if(elapsed < 1600 && !matchMedia('(prefers-reduced-motion: reduce)').matches) requestAnimationFrame(frame);
        else ctx.clearRect(0,0,W,H);
      }
      requestAnimationFrame(frame);
    }

    /* ============================================================
       BALLOONS
       ============================================================ */
    function spawnBalloons(count=26){
      const palette = [
        'hsl(330 95% 72%)','hsl(280 85% 75%)','hsl(322 85% 72%)','hsl(260 75% 70%)','hsl(300 70% 72%)'
      ];
      const rm = matchMedia('(prefers-reduced-motion: reduce)').matches;
      const minDur = rm? 0.01 : 14;
      const maxDur = rm? 0.02 : 22;

      for(let i=0;i<count;i++){
        const b = document.createElement('div');
        b.className = 'balloon';
        const clr = palette[Math.floor(Math.random()*palette.length)];
        const left = Math.random()*100;
        const drift = (Math.random()*2-1) * 90 + 'px';
        b.style.left = `min(calc(${left}vw - 16px), calc(100vw - 24px))`;
        b.style.background = `radial-gradient(circle at 30% 30%, #fff6, transparent 35%), ${clr}`;
        b.style.setProperty('--x', drift);
        b.style.animationDuration = (Math.random()*(maxDur-minDur)+minDur) + 's';
        b.style.animationDelay = (Math.random()*1.8) + 's';
        balloonsLayer.appendChild(b);
        const kill = () => b.remove();
        b.addEventListener('animationend', kill);
        setTimeout(kill, 32000);
      }
    }

    /* ============================================================
       STICKERS (cute hearts & cats)
       ============================================================ */
    const STICKERS = [
      `<svg viewBox="0 0 64 64" aria-hidden="true">
         <defs><linearGradient id="g1" x1="0" y1="0" x2="1" y2="1">
           <stop offset="0" stop-color="#ffd7ef"/><stop offset="1" stop-color="#ff8bd2"/></linearGradient></defs>
         <path d="M10 26c0 14 10 24 22 24s22-10 22-24l4-12-10 5c-4-5-10-7-16-7s-12 2-16 7l-10-5 4 12z" fill="url(#g1)" stroke="#2a0f22" stroke-opacity=".25"/>
         <circle cx="26" cy="34" r="3" fill="#2a0f22"/><circle cx="38" cy="34" r="3" fill="#2a0f22"/>
         <path d="M28 42c3 2 5 2 8 0" stroke="#2a0f22" stroke-width="2" stroke-linecap="round" fill="none"/>
       </svg>`,
      `<svg viewBox="0 0 64 64" aria-hidden="true">
         <circle cx="32" cy="40" r="12" fill="#b784ff"/><circle cx="18" cy="28" r="6" fill="#b784ff"/>
         <circle cx="46" cy="28" r="6" fill="#b784ff"/><circle cx="26" cy="22" r="5" fill="#b784ff"/><circle cx="38" cy="22" r="5" fill="#b784ff"/>
         <path d="M22 40c6 4 14 4 20 0" stroke="#2a0f22" stroke-opacity=".25"/>
       </svg>`,
      `<svg viewBox="0 0 64 64" aria-hidden="true">
         <path d="M32 54s-14-9-20-16C6 32 6 22 14 18c6-3 12 0 14 4 2-4 8-7 14-4 8 4 8 14 2 20-6 7-20 16-20 16z" fill="#ff8bd2" />
         <path d="M20 16l2-4m4 2l2-4" stroke="#ffd7ef" stroke-linecap="round"/>
       </svg>`,
      `<svg viewBox="0 0 64 64" aria-hidden="true">
         <path d="M12 28c0-7 6-12 12-12 5 0 8 2 8 5s3-5 10-5c8 0 14 7 12 16-3 12-18 21-22 24-4-3-20-12-22-24z" fill="#ffa1d9"/>
       </svg>`,
      `<svg viewBox="0 0 64 64" aria-hidden="true">
         <path d="M32 50C14 38 10 32 10 24c0-6 5-10 10-10 6 0 10 6 12 8 2-2 6-8 12-8 5 0 10 4 10 10 0 8-4 14-22 26z" fill="none" stroke="#ffb3e6" stroke-width="3"/>
       </svg>`
    ];

    function spawnStickers(count=28, disableAnim=false){
      const W = innerWidth, H = innerHeight;
      const centerBox = { x1: W*0.22, y1: H*0.22, x2: W*0.78, y2: H*0.78 };
      for(let i=0;i<count;i++){
        const el = document.createElement('div');
        el.className = 'sticker';
        const r = Math.random();
        if(r < 0.6) el.innerHTML = STICKERS[2 + Math.floor(Math.random()*3)];
        else el.innerHTML = STICKERS[Math.floor(Math.random()*2)];
        let x = Math.random()*W, y = Math.random()*H;
        if(x>centerBox.x1 && x<centerBox.x2 && y>centerBox.y1 && y<centerBox.y2){
          const toLeft=x-centerBox.x1, toRight=centerBox.x2-x, toTop=y-centerBox.y1, toBottom=centerBox.y2-y;
          const min = Math.min(toLeft,toRight,toTop,toBottom);
          if(min===toLeft) x=centerBox.x1-16; else if(min===toRight) x=centerBox.x2+16; else if(min===toTop) y=centerBox.y1-16; else y=centerBox.y2+16;
        }
        const sizeFactor = (Math.random()*1.4 + 0.6).toFixed(2);
        const alpha      = (Math.random()*0.18 + 0.26).toFixed(2);
        const dx         = (Math.random()*26+12) * (Math.random()<0.5?-1:1);
        const dy         = -(Math.random()*28+16);
        const dur        = (Math.random()*6+9).toFixed(2) + 's';
        el.style.left = Math.max(4, Math.min(W-60, x)) + 'px';
        el.style.top  = Math.max(4, Math.min(H-60, y)) + 'px';
        el.style.setProperty('--sz', sizeFactor);
        el.style.setProperty('--alpha', alpha);
        el.style.setProperty('--dx', dx+'px');
        el.style.setProperty('--dy', dy+'px');
        el.style.setProperty('--dur', dur);
        if(disableAnim) el.style.animation = 'none';
        stickersLayer.appendChild(el);
      }
    }

    /* ============================================================
       Keyboard shortcuts
       ============================================================ */
    addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight'){ next(); kickAutoplay(); }
      if(e.key === 'ArrowLeft'){ prev(); kickAutoplay(); }
      if((e.key === ' ' || e.key === 'k') && !e.target.closest('button, a, input, textarea')){
        e.preventDefault();
        if(!musicToggle.hasAttribute('hidden')) musicToggle.click();
      }
    });

    /* ============================================================
       INIT
       ============================================================ */
    renderSlides();
  })();
  </script>

  <!-- =========================================================
       QUICK EDIT HELP
       - Friend‚Äôs name: search id="friendName" above
       - Accent colors: change --accent / --accent-2 in :root
       - Background: tweak --bg-* and gradients in body
       - Wallpaper: change #wallpaper background-image
       - Slideshow ratio: set --ratio on .slideshow (e.g., 16/9)
       ========================================================= -->
</body>
</html>
