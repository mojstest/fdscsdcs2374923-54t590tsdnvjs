<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================================
       META / HEAD
       ========================================================= -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>🎂 Happy Birthday!</title>

  <!-- Performance -->
  <link rel="preload" as="audio" href="assets/music.mp3" />
  <!-- Optional: preload wallpaper for faster paint -->
  <link rel="preload" as="image" href="assets/photo7.jpg" />

  <style>
    /* =========================================================
       THEME TOKENS  (// EDIT HERE: colors)
       ========================================================= */
    :root{
      --accent: #ff7ac6;     /* EDIT HERE: primary accent */
      --accent-2: #78f3ff;   /* EDIT HERE: secondary accent */

      --bg-1: #0b1020;       /* EDIT HERE: deep background */
      --bg-2: #141b34;       /* EDIT HERE: gradient top */
      --bg-3: #1d2a54;

      --card: color-mix(in oklab, #000 65%, #fff 0%);
      --text: #f6f7fb;
      --muted: #c6c9d4;

      --radius-lg: 16px;
      --radius-md: 12px;
      --shadow-1: 0 10px 30px rgba(0,0,0,.35);
      --shadow-2: 0 6px 18px rgba(0,0,0,.28);

      --gap: clamp(12px, 2.8vw, 24px);
      --pad: clamp(12px, 2.5vw, 20px);
    }

    /* =========================================================
       BASE / RESET
       ========================================================= */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        /* deep gradient */
        radial-gradient(40% 60% at 50% 110%, #0a0f22 0%, transparent 70%),
        linear-gradient(180deg, var(--bg-2), var(--bg-1));
      overflow-x:hidden;
      line-height:1.45;
    }

    :focus-visible{ outline: 2px dashed var(--accent); outline-offset: 3px }
    a,button,input,select,textarea{font:inherit}
    button{cursor:pointer}

    /* =========================================================
       BACKGROUND FX (bokeh) + WALLPAPER
       ========================================================= */

    /* Subtle animated bokeh dots (perf-friendly) - stays even with wallpaper */
    body::before{
      content:"";
      position:fixed; inset:-10vmax;
      z-index:-1; /* above wallpaper, below content */
      background:
        radial-gradient(120px 120px at 20% 30%, color-mix(in oklab, var(--accent) 22%, transparent) 0 60%, transparent 61%) ,
        radial-gradient(160px 160px at 80% 70%, color-mix(in oklab, var(--accent-2) 20%, transparent) 0 60%, transparent 61%),
        radial-gradient(90px 90px at 60% 20%, color-mix(in oklab, #ffd166 28%, transparent) 0 60%, transparent 61%);
      filter: blur(12px);
      opacity:.25;
      animation: drift 26s linear infinite;
      pointer-events:none;
    }
    @keyframes drift{
      from{ transform: translate3d(-2%, -1%, 0) rotate(0deg) }
      to  { transform: translate3d(2%, 1%, 0) rotate(1turn) }
    }
    @media (prefers-reduced-motion: reduce){ body::before{ animation: none; opacity:.18 } }

    /* Wallpaper that fills MOST of the background, not all */
    /* Uses a fixed inset container so gradients remain visible around edges */
    #wallpaper{
      position: fixed;
      inset: clamp(16px, 6vmin, 64px); /* leave a nice margin so background shows */
      z-index: -2;                     /* below bokeh, above body background */
      background-image: url("assets/photo7.jpg"); /* // EDIT HERE: choose preferred wallpaper photo */
      background-size: cover;
      background-position: center;
      border-radius: clamp(12px, 3.2vw, 22px);
      box-shadow: 0 40px 120px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.06);
      filter: saturate(1.05) contrast(1.06) brightness(.8);
      opacity: .32;                    /* subtle so content stays readable */
      pointer-events: none;
    }

    /* =========================================================
       HEADER / HERO
       ========================================================= */
    header{
      text-align:center;
      padding: clamp(16px, 4vw, 40px) var(--pad) 10px;
    }
    .hero-badge{
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background-image: linear-gradient(180deg, #ffd3ec, #d8fff8);
      color:#231826;
      font-weight:600;
      box-shadow: var(--shadow-2);
      letter-spacing:.2px;
    }
    h1{
      margin: .5rem 0 0;
      font-size: clamp(2rem, 6.5vw, 4rem);
      line-height:1.05;
      letter-spacing:.5px;
      text-shadow: 0 2px 0 rgba(0,0,0,.25);
    }
    .hero-sub{
      margin-top:.35rem;
      font-size: clamp(1rem, 3.4vw, 1.3rem);
      color:var(--muted);
    }

    /* =========================================================
       LAYOUT
       ========================================================= */
    main{
      display:grid;
      gap: var(--gap);
      padding: 0 var(--pad) var(--pad);
      grid-template-columns: 1fr;
      max-width: 1160px;
      margin: 0 auto;
      position: relative;
      z-index: 0;
    }
    @media (min-width: 860px){
      main{ grid-template-columns: 1fr 1fr; align-items: start; }
    }

    .card{
      background: color-mix(in oklab, var(--card), transparent 0%);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-1);
      overflow: clip;
      border: 1px solid color-mix(in oklab, #fff 6%, #000 94%);
    }

    /* =========================================================
       SLIDESHOW / CAROUSEL
       ========================================================= */
    .slideshow{ display:grid; grid-template-rows: auto auto; gap: 8px; padding: 8px; }
    .viewport{
      position:relative;
      border-radius: clamp(10px, 2vw, 14px);
      overflow:hidden;
      aspect-ratio: 4 / 3;
      background: #0f1428;
      outline: 1px solid rgba(255,255,255,.06);
    }
    .track{ display:flex; height:100%; will-change: transform; transition: transform .55s cubic-bezier(.22,.61,.36,1); }
    .slide{ flex:0 0 100%; height:100%; }
    .slide > img{ width:100%; height:100%; object-fit:cover; display:block; }
    .slide-caption{
      position:absolute; left:10px; bottom:10px;
      background: color-mix(in oklab, #000 40%, var(--accent) 10%);
      color:#fff; padding: 6px 10px; border-radius: 999px;
      font-size: clamp(.75rem, 2.4vw, .9rem);
      backdrop-filter: blur(6px);
    }
    .controls{ display:flex; align-items:center; gap:8px; justify-content: space-between; padding: 6px; }
    .btn{
      appearance:none; border: 0; padding: .6rem .9rem; border-radius: 12px;
      background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 86%, #fff 0%), color-mix(in oklab, var(--accent) 64%, #000 10%));
      color:#1c0e16; font-weight: 700; letter-spacing:.2px;
      box-shadow: 0 4px 14px rgba(255, 122, 198, .25);
    }
    .btn.secondary{ background: linear-gradient(180deg, #2b335a, #1b2348); color:#e8ecff; box-shadow: 0 4px 14px rgba(0,0,0,.25); }
    .dots{ display:flex; gap:6px; align-items:center; margin-inline: auto; }
    .dot{ width:8px; height:8px; border-radius:999px; background:#49507d; opacity:.8; }
    .dot[aria-current="true"]{ background: var(--accent-2); box-shadow: 0 0 0 3px rgba(120,243,255,.18) }

    /* =========================================================
       UTILITY ROW (Play/Pause + Share)
       - Music button is hidden until party starts (per your request)
       ========================================================= */
    .utility{ display:flex; flex-wrap:wrap; gap:8px; padding: var(--pad); justify-content:center; }
    .pill{
      background: linear-gradient(180deg, #232a4a, #1a203e);
      border:1px solid rgba(255,255,255,.08);
      color:#e8ecff; border-radius: 999px; padding: .55rem .9rem;
      display:inline-flex; align-items:center; gap:.5rem; box-shadow: var(--shadow-2);
    }
    .pill .mini{ font-size: .95rem }
    .pill .icon{ filter: drop-shadow(0 1px 0 rgba(0,0,0,.25)) }
    #musicToggle[hidden]{ display:none !important; }

    /* =========================================================
       VIDEO CARD
       ========================================================= */
    .video-card{ padding: var(--pad); display:grid; gap:10px; }
    video{
      width:100%; height:auto; border-radius: var(--radius-md); display:block;
      box-shadow: var(--shadow-1); background:#0a0f22; outline: 1px solid rgba(255,255,255,.06);
    }
    .video-note{ color:var(--muted); font-size: .95rem }

    /* =========================================================
       FOOTER
       ========================================================= */
    footer{
      text-align:center; color: var(--muted);
      padding: 20px var(--pad) 36px; font-size: clamp(.9rem, 2.3vw, 1rem);
    }

    /* =========================================================
       START OVERLAY (user gesture)
       ========================================================= */
    .overlay{
      position:fixed; inset:0; z-index: 9999; display:grid; place-items:center;
      background:
        radial-gradient(60vmax 40vmax at 50% 30%, color-mix(in oklab, var(--accent) 5%, transparent) 0 70%, transparent),
        linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.65));
      backdrop-filter: blur(2px);
    }
    .overlay-inner{ text-align:center; display:grid; gap: 12px; }
    .party-btn{
      font-size: clamp(1.05rem, 4.6vw, 1.35rem); padding: .9rem 1.3rem; border-radius: 14px; border:0;
      color:#1a0e14; font-weight:800; letter-spacing:.3px;
      background: conic-gradient(from 0deg, #ffe3f6, #d9fff9, #fff3c7, #ffe3f6);
      box-shadow: 0 10px 28px rgba(255, 122, 198, .35);
    }
    .overlay-hint{ color:#d6dbff; font-size:.95rem }

    /* =========================================================
       EFFECTS LAYERS (confetti + balloons)
       ========================================================= */
    #confetti{ position: fixed; inset:0; pointer-events:none; z-index: 9990 }
    #balloons{ position: fixed; inset:0; pointer-events:none; z-index: 9980; overflow:hidden }
    .balloon{
      position:absolute;
      width: clamp(20px, 4.6vw, 32px);
      height: clamp(28px, 7vw, 48px);
      border-radius: 50% 50% 45% 45% / 55% 55% 45% 45%;
      opacity:.92;
      transform: translateY(100vh);
      box-shadow: inset 0 -8px 18px rgba(0,0,0,.18);
      animation: rise linear both;
    }
    .balloon::after{ /* string */
      content:"";
      position:absolute; left:50%; bottom:-40%;
      width:2px; height: 40%;
      background: linear-gradient(180deg, #b6c1ff, #5d6bff);
      transform: translateX(-50%);
      opacity:.7;
    }
    /* Longer on-screen time (per your request) */
    @keyframes rise{
      from{ transform: translateY(105vh) translateX(var(--x, 0)) rotate(-2deg) }
      to  { transform: translateY(-110px) translateX(calc(var(--x, 0) + 10px)) rotate(6deg) }
    }
    @media (prefers-reduced-motion: reduce){ .balloon{ animation-duration: .001s } }

    /* =========================================================
       TOAST (copy/share feedback)
       ========================================================= */
    .toast{
      position: fixed; left:50%; bottom: 18px; transform: translateX(-50%);
      background: #101736; color:#e8ecff; padding: .6rem .9rem; border-radius: 999px;
      border:1px solid rgba(255,255,255,.08); box-shadow: var(--shadow-2);
      opacity:0; translate: 0 6px; transition: opacity .25s, translate .25s; z-index: 99999;
    }
    .toast.show{ opacity:1; translate: 0 0 }

    /* =========================================================
       REDUCED DATA / MOTION
       ========================================================= */
    @media (prefers-reduced-data: reduce){ body::before{ opacity:.12 } }
  </style>
</head>
<body>
  <!-- =========================================================
       BACKGROUND WALLPAPER LAYER (fills most, not all)
       ========================================================= -->
  <div id="wallpaper" aria-hidden="true"></div>

  <!-- =========================================================
       HEADER / HERO
       ========================================================= -->
  <header aria-labelledby="title">
    <span class="hero-badge" aria-hidden="true">🎉 It’s Party Time</span>
    <h1 id="title">Happy Birthday <span id="friendName"> <!-- // EDIT HERE: your friend’s name -->Alex</span>! 🥳</h1>
    <p class="hero-sub">Tap the button below to start the party — music, confetti & balloons will appear!</p>
  </header>

  <!-- =========================================================
       MAIN CONTENT
       ========================================================= -->
  <main>
    <!-- ===================== SLIDESHOW ===================== -->
    <section class="card slideshow" aria-label="Photo slideshow">
      <div class="viewport" aria-live="polite">
        <div class="track" id="track" style="transform: translateX(0%)">
          <figure class="slide">
            <img src="assets/photo1.jpg" alt="Photo 1: A favorite birthday memory" width="1200" height="900" loading="lazy" decoding="async" />
            <figcaption class="slide-caption">#1</figcaption>
          </figure>
          <figure class="slide">
            <img src="assets/photo2.jpg" alt="Photo 2: Smiles and fun times" width="1200" height="900" loading="lazy" decoding="async" />
            <figcaption class="slide-caption">#2</figcaption>
          </figure>
          <figure class="slide">
            <img src="assets/photo3.jpg" alt="Photo 3: Friends celebrating together" width="1200" height="900" loading="lazy" decoding="async" />
            <figcaption class="slide-caption">#3</figcaption>
          </figure>
          <figure class="slide">
            <img src="assets/photo4.jpg" alt="Photo 4: A cheerful birthday moment" width="1200" height="900" loading="lazy" decoding="async" />
            <figcaption class="slide-caption">#4</figcaption>
          </figure>
          <figure class="slide">
            <img src="assets/photo5.jpg" alt="Photo 5: Making a wish" width="1200" height="900" loading="lazy" decoding="async" />
            <figcaption class="slide-caption">#5</figcaption>
          </figure>
          <figure class="slide">
            <img src="assets/photo6.jpg" alt="Photo 6: More cake, more joy" width="1200" height="900" loading="lazy" decoding="async" />
            <figcaption class="slide-caption">#6</figcaption>
          </figure>
          <figure class="slide">
            <img src="assets/photo7.jpg" alt="Photo 7: The perfect celebration" width="1200" height="900" loading="lazy" decoding="async" />
            <figcaption class="slide-caption">#7</figcaption>
          </figure>
        </div>
      </div>

      <div class="controls">
        <button class="btn secondary" id="prev" aria-label="Previous photo">⟵ Prev</button>
        <div class="dots" role="tablist" aria-label="Slide indicators">
          <span class="dot" data-i="0" aria-current="true" role="tab" aria-label="Photo 1"></span>
          <span class="dot" data-i="1" role="tab" aria-label="Photo 2"></span>
          <span class="dot" data-i="2" role="tab" aria-label="Photo 3"></span>
          <span class="dot" data-i="3" role="tab" aria-label="Photo 4"></span>
          <span class="dot" data-i="4" role="tab" aria-label="Photo 5"></span>
          <span class="dot" data-i="5" role="tab" aria-label="Photo 6"></span>
          <span class="dot" data-i="6" role="tab" aria-label="Photo 7"></span>
        </div>
        <button class="btn secondary" id="next" aria-label="Next photo">Next ⟶</button>
      </div>

      <div class="utility" role="group" aria-label="Utilities">
        <!-- Music control is hidden until "Start Party" is tapped (per your request) -->
        <button class="pill" id="musicToggle" hidden aria-pressed="false" aria-label="Play or pause the birthday music">
          <span class="icon" aria-hidden="true">🎵</span><span class="mini" id="musicLabel">Play music</span>
        </button>
        <button class="pill" id="shareBtn" aria-label="Share or copy link">
          <span class="icon" aria-hidden="true">🔗</span><span class="mini">Share / Copy link</span>
        </button>
      </div>
    </section>

    <!-- ===================== VIDEO ===================== -->
    <section class="card video-card" aria-labelledby="vidTitle">
      <h2 id="vidTitle" style="margin:0; font-size: clamp(1.2rem, 4.2vw, 1.6rem)">A little birthday clip 🎬</h2>
      <video
        src="assets/video.mp4"
        poster="assets/photo1.jpg"
        preload="metadata"
        playsinline
        controls
        width="1280"
        height="720"
      >
        Sorry, your browser can’t play the embedded video.
      </video>
      <p class="video-note">Tip: On mobile, rotate your phone for a bigger view.</p>
    </section>
  </main>

  <!-- =========================================================
       FOOTER
       ========================================================= -->
  <footer>
    © <span id="year"></span> With love • Made for joyful moments.
  </footer>

  <!-- =========================================================
       START OVERLAY (user gesture to start audio & effects)
       ========================================================= -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-label="Start birthday celebration">
    <div class="overlay-inner">
      <button id="start" class="party-btn">💥 Tap to start the party!</button>
      <div class="overlay-hint">Starts music, confetti & balloons. You’ll get a Play/Pause button too.</div>
    </div>
  </div>

  <!-- =========================================================
       EFFECTS LAYERS
       ========================================================= -->
  <canvas id="confetti" aria-hidden="true"></canvas>
  <div id="balloons" aria-hidden="true"></div>

  <!-- =========================================================
       MEDIA
       ========================================================= -->
  <audio id="music" src="assets/music.mp3" preload="none"></audio>

  <!-- =========================================================
       LIVE REGIONS / TOAST
       ========================================================= -->
  <div id="sr" class="sr-only" aria-live="polite" style="position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden;">Ready</div>
  <div id="toast" class="toast" role="status" aria-live="polite">Copied!</div>

  <script>
  /* ============================================================
     UTILITIES
     ============================================================ */
  (function(){
    const $  = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    /* ------------------------------------------------------------
       ELEMENT REFERENCES
       ------------------------------------------------------------ */
    const overlay       = $('#overlay');
    const startBtn      = $('#start');
    const music         = $('#music');
    const musicToggle   = $('#musicToggle');
    const musicLabel    = $('#musicLabel');
    const shareBtn      = $('#shareBtn');
    const toast         = $('#toast');
    const confettiCanvas= $('#confetti');
    const balloonsLayer = $('#balloons');
    const sr            = $('#sr');
    const nameEl        = $('#friendName');
    const yearEl        = $('#year');

    const track = $('#track');
    const slides= $$('.slide');
    const dots  = $$('.dot');
    const prev  = $('#prev');
    const next  = $('#next');

    /* ------------------------------------------------------------
       STATE
       ------------------------------------------------------------ */
    let index = 0;
    let hasCelebrated = false;
    yearEl.textContent = new Date().getFullYear();
    if(!nameEl.textContent.trim()){ nameEl.textContent = 'Friend'; }

    /* ------------------------------------------------------------
       PREFERENCES
       ------------------------------------------------------------ */
    const prefersReducedMotion = () => window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const prefersReducedData   = () => (navigator.connection?.saveData) || window.matchMedia('(prefers-reduced-data: reduce)').matches;

    /* ============================================================
       SLIDESHOW LOGIC
       ============================================================ */
    function go(i, announce=true){
      index = (i + slides.length) % slides.length;
      track.style.transform = `translateX(-${index*100}%)`;
      dots.forEach((d, di)=> d.setAttribute('aria-current', di===index ? 'true' : 'false'));
      if(announce){ sr.textContent = `Photo ${index+1} of ${slides.length}`; }
    }
    function nextSlide(){ go(index+1); }
    function prevSlide(){ go(index-1); }
    next.addEventListener('click', nextSlide);
    prev.addEventListener('click', prevSlide);
    dots.forEach(d => d.addEventListener('click', ()=> go(+d.dataset.i)));

    // Pointer/touch swipe
    (()=> {
      let x0=null, t=null;
      const vp = $('.viewport');
      const onStart = (e)=>{ x0=(e.touches?e.touches[0].clientX:e.clientX); t=Date.now(); };
      const onEnd   = (e)=>{
        if(x0==null) return;
        const x1 = (e.changedTouches?e.changedTouches[0].clientX:e.clientX);
        const dx = x1 - x0;
        const dt = Date.now()-t;
        if(Math.abs(dx)>40 && dt<600){ dx<0 ? nextSlide() : prevSlide(); }
        x0=null;
      };
      vp.addEventListener('pointerdown', onStart);
      vp.addEventListener('pointerup', onEnd);
      vp.addEventListener('touchstart', onStart, {passive:true});
      vp.addEventListener('touchend', onEnd);
    })();

    /* ============================================================
       MUSIC CONTROLS
       - Hidden until party starts.
       - Start overlay triggers music play (user gesture compliant).
       ============================================================ */
    function updateMusicUI(){
      const playing = !music.paused;
      musicToggle.setAttribute('aria-pressed', String(playing));
      musicLabel.textContent = playing ? 'Pause music' : 'Play music';
    }
    musicToggle.addEventListener('click', async ()=>{
      try{
        if(music.paused){ await music.play(); }
        else { music.pause(); }
      }catch{
        showToast('Unable to play audio. Check device volume.');
      }finally{ updateMusicUI(); }
    });
    music.addEventListener('play', updateMusicUI);
    music.addEventListener('pause', updateMusicUI);

    /* ============================================================
       SHARE / COPY LINK
       ============================================================ */
    shareBtn.addEventListener('click', async ()=>{
      const shareData = { title: document.title, text: '🎂 Join the birthday page!', url: location.href };
      try{
        if(navigator.share){
          await navigator.share(shareData);
        }else{
          await navigator.clipboard.writeText(location.href);
          showToast('Link copied to clipboard ✔️');
        }
      }catch(e){
        try{
          await navigator.clipboard.writeText(location.href);
          showToast('Link copied to clipboard ✔️');
        }catch{
          showToast('Copy failed. Long-press the address bar to share.');
        }
      }
    });

    /* ============================================================
       TOAST HELPER
       ============================================================ */
    let toastTimer = null;
    function showToast(msg='Done'){
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=> toast.classList.remove('show'), 1800);
    }

    /* ============================================================
       START OVERLAY -> PARTY!
       - Plays music
       - Confetti (single burst)
       - Balloons (linger longer, per request)
       - Reveals Play/Pause button automatically and focuses it
       ============================================================ */
    startBtn.addEventListener('click', async ()=>{
      if(hasCelebrated) return;

      // Start music (user gesture)
      try{ await music.play(); }catch{}

      // Reveal and focus Play/Pause button (per your request)
      musicToggle.removeAttribute('hidden');
      updateMusicUI();
      setTimeout(()=> musicToggle.focus(), 60);

      // Effects
      celebrate();

      // Remove overlay
      overlay.remove();
    });

    // Keyboard on overlay
    overlay.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault(); startBtn.click();
      }
    });

    function celebrate(){
      if(hasCelebrated) return;
      hasCelebrated = true;

      if(!prefersReducedData()){
        confettiBurst();        // single burst
        spawnBalloons(24);      // more balloons + longer duration
      }else{
        showToast('Effects reduced to save data.');
      }
    }

    /* ============================================================
       CONFETTI (single burst)
       ============================================================ */
    function confettiBurst(){
      const ctx = confettiCanvas.getContext('2d');
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const {innerWidth: W, innerHeight: H} = window;
      confettiCanvas.width = Math.floor(W * dpr);
      confettiCanvas.height = Math.floor(H * dpr);
      confettiCanvas.style.width = W + 'px';
      confettiCanvas.style.height = H + 'px';
      ctx.scale(dpr, dpr);

      const n = 150;
      const colors = ['#ffd166','#06d6a0','#118ab2','#ef476f','#a78bfa','#fca5a5','#7dd3fc'];
      const parts = Array.from({length:n}, ()=>({
        x: W/2, y: H*0.35,
        vx: (Math.random()*2-1)*7,
        vy: (Math.random()*-1-0.8)*10,
        w: Math.random()*8+5,
        h: Math.random()*3+2,
        rot: Math.random()*Math.PI,
        vr: (Math.random()*2-1)*0.2,
        col: colors[(Math.random()*colors.length)|0]
      }));
      const start = performance.now();
      const grav = 0.25, air = 0.996;

      function frame(t){
        const elapsed = t - start;
        ctx.clearRect(0,0,W,H);
        for(const p of parts){
          p.vy += grav;
          p.vx *= air; p.vy *= air;
          p.x += p.vx; p.y += p.vy;
          p.rot += p.vr;
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.rot);
          ctx.fillStyle = p.col;
          ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
          ctx.restore();
        }
        if(elapsed < 1600 && !prefersReducedMotion()) requestAnimationFrame(frame);
        else ctx.clearRect(0,0,W,H); // cleanup after ~1.6s
      }
      requestAnimationFrame(frame);
    }

    /* ============================================================
       BALLOONS (linger longer)
       - Increased animation durations and cleanup time
       ============================================================ */
    function spawnBalloons(count=72){
      const palette = [
        'hsl(330 95% 72%)', /* pink */
        'hsl(193 95% 68%)', /* aqua */
        'hsl(49 95% 65%)',  /* yellow */
        'hsl(262 95% 78%)', /* purple */
        'hsl(146 62% 61%)'  /* green */
      ];
      // Longer screen time (per request)
      const minDur = prefersReducedMotion()? 0.01 : 14;  // was 9
      const maxDur = prefersReducedMotion()? 0.02 : 22;  // was 14

      for(let i=0;i<count;i++){
        const b = document.createElement('div');
        b.className = 'balloon';
        const clr = palette[Math.floor(Math.random()*palette.length)];
        const left = Math.random()*100;
        const drift = (Math.random()*2-1) * 90 + 'px'; // a bit more drift
        b.style.left = `min(calc(${left}vw - 16px), calc(100vw - 24px))`;
        b.style.background = `radial-gradient(circle at 30% 30%, #fff8, transparent 35%), ${clr}`;
        b.style.setProperty('--x', drift);
        b.style.animationDuration = (Math.random()*(maxDur-minDur)+minDur) + 's';
        b.style.animationDelay = (Math.random()*1.8) + 's';
        balloonsLayer.appendChild(b);
        const kill = () => b.remove();
        b.addEventListener('animationend', kill);
        setTimeout(kill, 32000); // increased cleanup timeout
      }
    }

    /* ============================================================
       KEYBOARD SHORTCUTS
       ============================================================ */
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight') nextSlide();
      if(e.key === 'ArrowLeft')  prevSlide();
      if((e.key === ' ' || e.key === 'k') && !e.target.closest('button, a, input, textarea')){
        e.preventDefault();
        if(!musicToggle.hasAttribute('hidden')) musicToggle.click();
      }
    });

    // Init
    go(0, false);
  })();
  </script>

  <!-- =========================================================
       QUICK EDIT HELP
       - Friend’s name: search id="friendName" above
       - Accent colors: change --accent / --accent-2 in :root
       - Background: tweak --bg-* and gradients in body
       - Wallpaper: change #wallpaper background-image
       ========================================================= -->
</body>
</html>
